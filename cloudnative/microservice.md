# 简介
微服务一种开发软件的架构和组织方法。在云原生时代，微服务架构越来越流行。

## 微服务治理
微服务架构中，一个系统往往有成百上千个微服务。需要有相应的微服务分析与治理的方法。
在微服务治理的生态链中，往往包括服务注册发现、服务配置、弹性扩容、自动故障恢复、格力、服务熔断、网关、负载均衡、链路追踪、日志采集、监控平台等。在通过相关监控、分析发现问题后，往往可以对相应的微服务进行恢复、限制等操作。

而限流、熔断、降级是针对业务节点的常用微服务保护方式:
- 限流: 单个微服务节点的负载能力有限，限流可以保护服务不至于流量过大，对节点增加一层保障。
- 熔断: 若服务响应时间过长或者不可调用的次数过多，及时的熔断可以提升整体的可用性。
- 降级: 熔断之后，业务方可以选择降级处理，进行不处理或简单处理，保证整体可用性。

### 限流器
常见的限流算法有固定窗口、滑动窗口、漏桶、令牌桶.
- **令牌桶**: 系统以恒定的速率向桶中放 token, 桶满则暂时不放. 如果桶中有剩余 token 可以一直取, 如果没有剩余 token, 需要等桶中被放置了 Token 才行. 适用于电商抢购、热点事件等应对突增场景.
- **漏桶**: 固定容量的漏桶, 水流可以按照任意速率进入到漏桶里, 但漏桶总是以固定速率匀速流出. 优点和缺点均是匀速, 可以应对突增流量但是浪费了系统性能. 适用于数据库限流等场景, 用于保护第三方的被调系统.
- **计数器**: 计数器算法也称固定窗口算法. 在一定的时间里, 记录请求次数, 当请求次数超过时间限制时, 就把计数器清零, 然后重新计算. 请求次数超限的时候, 拒绝访问. 计数器算法实现简单, 但是存在"突刺现象".
- **滑动窗口**: 滑动窗口是对固定窗口计数器方法的改进. 固定窗口在遇到时间窗口的临界突变时有问题, 滑动窗口则在固定窗口的基础上，在时间窗口内会进行调整时间窗口, 这样就会减少临界突变的问题.

## Service Mesh
早期的微服务治理能力主要在微服务框架层实现，与业务逻辑一同编译到一个进程中。而在 云原生 及ServiceMesh 开始兴起后，微服务的通用能力渐渐的向通用基础层过度。ServcieMesh 则致力于将通用能力做成微服务时代的 TCP, 让业务侧不用在关注微服务治理相关的工作。

## SET 化部署
SET 化部署将业务系统分成多个逻辑分区(SET), 能独立提供服务, 在 SET 间实现数据互备、流量调度. 常规的业务应用，通常被部署为无状态的应用实例组成的集群, 当发展到一定体量, 会面临容灾能力不足, 扩展瓶颈等问题. 单机房部署、单地区部署风险越来越高, 一旦出现问题, 会带来难以承受的损失. 也会遇到数据库扩展瓶颈、机房容量瓶颈等扩展性问题. 所以会出现将业务系统先分解再组合, 也就是 SET 化.

## 质量体系
质量保障体系是通过一定的流程规范、测试技术和方法, 借助持续集成/持续交付等技术把质量保障活动有效组合, 形成系统化、标准化和规范化的保障体系. 同时需要相应的度量、运营手段及组织能力的保障.

## 参考
1. [限流、熔断与降级](https://xie.infoq.cn/article/2593d1a3b9e1e06cac6502c4f)
2. [Golang官方限流器的用法详解](https://juejin.cn/post/6981291908291100680)
3. [面试官：限流算法有哪些？](https://zhuanlan.zhihu.com/p/607749980)
4. [微服务质量保障](https://learn.lianglianglee.com/专栏/微服务质量保障%2020%20讲-完/00%20开篇词%20%20既往不恋，当下不杂，未来不迎.md)
5. [SET 化技术与美团点评实践解密](https://www.infoq.cn/article/edktgbzgi9q13dczo50a)