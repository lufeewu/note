# 操作系统
操作系统相关知识.
## 知识点
+ syscall 系统调用
+ 中断
+ 交叉编译
+ 六大子系统
    - 存储管理
    - 输入设备管理
    - 输出设备管理
    - 进程管理
    - 网络管理
    - 安全管理
- c/go 对操作系统接口的封装
<img src="img/system_go.png">    

- 临界区: 一个访问共用资源的程序片段, 这些共用资源无法同时被多个线程访问. 当有程序进入临界区段, 其它线程、进程必须等待. 一些同步机制必须在临界区段的进入点与离开点实现, 确保共用资源是被互斥获得使用的. 如信号量 semaphore 机制.

### CPU 机制
- CAS 原子操作: 基于 CPU 提供的原子操作指令实现, 通过汇编指令前增加 LOCK 锁定系统总线, 编译器实现对应的原子操作函数. 通过将内存中的值与指定数据比较, 数值一样时将内存中的值替换为新值.

### 内存管理
操作系统的内存管理机制包括虚拟内存、分页、分段、页面置换算法等机制, 以提高内存利用效率及安全性。
- 虚拟内存: 让物理内存扩充成更大的逻辑内存, 让程序获得更多的可用内存. 操作系统将内存抽象成地址空间, 将地址空间分割成块, 每块称为一页, 将页映射到物理内存.
- 内存管理单元(MMU): 管理地址空间和物理内存的转换, 其中的页表存储着页(程序地址空间)和页框(物理内存空间)的映射表.
- 页面置换算法: 若页面不存在于内存中, 则通过缺页中断将页面调入内存中, 若内存中无空闲空间, 则需要从内存中调出页面到磁盘.
    + 最佳置换算法(OPT): 换出最长时间不被访问页面.
    + 最近最久未使用(LRU): 将最近最久未使用的页面换出, 需要维护一个所有页面的链表, 代价较高.
    + 最近未使用(NRU): 优先换出已被修改的脏页面.
    + 先近先出(FIFO): 优先换出最先进入的页面, 可能导致最常访问的页面被换出导致缺页率升高.
    + 第二次机会算法: 改进 FIFO 算法, 增加标记位 R 记录被访问情况. 优先替换先进入且又没有被访问过的页面.
    + 时钟(Clock): 改进第二次机会算法, 避免移动链表造成的低效. 通过环形链表连接页面.
- 分段: 通过将虚拟地址映射到物理地址, 每个程序都访问虚拟地址, 这样可以做到进程间的隔离, 提高安全性. 将每个表分成段, 一个段构成一个独立的地址空间, 每个段长度可以不同, 可以动态增长, 避免覆盖问题.
- 段页式: 程序的地址空间划分成多个拥有独立地址空间的段, 每个段上的地址空间划分成大小相同的页. 这样便可以拥有分段系统的共享和保护, 也有分页系统的虚拟内存功能.

## 参考
1. [Linux 为什么多进程能够读写正在删除的文件](https://blog.csdn.net/weiwangchao_/article/details/94578327)
2. [计算机操作系统 - 内存管理](https://github.com/CyC2018/CS-Notes/blob/master/notes/计算机操作系统%20-%20内存管理.md)